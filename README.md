# HyperMu
SAFETY DISCLAIMER: This software is intended strictly as a technical showcase for public viewing and commentary, NOT for public use, editing, or adoption. The simulation code within has not been fully validated for accuracy or real-world application. Do NOT apply any changes to real-world vehicles based on HyperMu simulation results. Modifying vehicle properties always carries a risk of deadly loss of vehicle control. Any attempt to use this software for real-world applications is highly discouraged and done at the userâ€™s own risk. The author assumes no liability for any consequences arising from such misuse. All rights reserved, Copyright 2024 Ivan Pandev.

## Multibody, time-dependent vehicle simulations by Ivan Pandev
HyperMu is a chassis response calculator solving for tire load, lateral load distribution, and other variables not directly measurable over time, using either real-world acceleration telemetry, or synthetic acceleration and road surface data as inputs. Intuitively speaking, HyperMu is a virtual '7+2'-post shaker rig, signifying that it can replay body acceleration inputs in addition to conventional 7-post shaker functionality.

The vehicle model consists of 6 solid bodies: Front chassis and rear chassis (connected by a torsion spring), and 4 unsprung suspension masses connected to the chassis by variations of springs, roll bars, dampers, etc. The system of differential equations describing the model's response is found in `chassis_model.py.` The transient response of this model is then solved using Runge-Kutta methods in `RK4_iterator.py,` and variables of interest are collected.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/demo4.png)

The above screenshot generated by HyperMu represents a race car model, `Battle_Bimmer_30_Sept_2023_w_Pass.yml`, responding to synthetic lateral and longitudinal inputs, with a bump affecting the inside tires on the right-handed turn. Demonstrated in the data is torsional chassis flex, suspension and tire harmonics, 0-load behavior on individual wheels, and much more. The screenshot generated by HyperMu below represents the same model responding to a replay of telemetry gathered during a real-world autocross race run, where chassis acceleration is known precisely, but surface conditions are assumed smooth.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/demo3.png)

HyperMu can perform frequency sweeps to find undesirable harmonics in a simulated chassis, as in the results below. In this case, the model `Battle_Bimmer_30_Sept_2023_w_Pass.yml` is compared to an updated model with reduced mass and roll geometry, `Battle_Bimmer_05_Jan_2025.yml`. HyperMu predicts the updated model will generally have less intense harmonic peaks, and the with a tighter distribution of forces and a lower root mean square (RMS) of the tire load signal. All of these metrics speak to the tire load variation, which should generally be minimized. The distribution and frequency plots can also be displayed for other unit tests or telemetry replay test scenarios.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/dist_freq_roll_sweep.png)

## Real-World Correlation
Maximizing correlation against real-world telemetry will drive and validate HyperMu development. While some HyperMu outputs like instantaneous tire load are extremely difficult to measure directly and capture in telemetry, HyperMu also predicts measurable responses to g-force, such as roll and pitch angle rates. As a cursory validation of HyperMu outputs' correlation to the real-world vehicle's dynamic behavior, its simulated roll angle rate outputs are compared to the corresponding data from telemetry. The correlation is optimized around the 750ms smoothing window. The choice to check correlation using roll angle rate was driven by it being the only available, reliable trace at the time. Roll and pitch angle traces were found to drift, and the sensor mount itself was likely flexing a small amount. Improvements to the sensor mount and trace selection will follow with future data collection runs.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/corr3.png)

In addition to dynamic correlation, static correlaton is also evaluated, isolating the effects of kinematics, compliance, and spring stiffnesses from sources of error in damping, inertia, and hystersis. The weight transfers below are measured by applying a ~38mm deflection to one wheel at a time, which is replicated in HyperMu and the results allowed to settle. Better modelling of non-linearities in HyperMu's tire model and kinematics are expected to improve static correlation especially.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/static_corr_1.png)

## Ongoing Development
HyperMu's core functionality (a multi-body vehicle model and solvers for its dynamic response to road and acceleration conditions) is practically complete, but much work remains on capturing increasingly-granular details of vehicle response, creating new visualization tools, and maximizing real-world correlation. This includes but is not limited to:
- Non-linearity in the tire spring/damper model
- Hysteresis modelling in dampers and tires
- Better yaw-correction for pitch telemetry
- Signal processing tools for input telemetry

I greatly look forward to delivering as many of these as possible!
